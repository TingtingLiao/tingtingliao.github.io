<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Katyusha | Tingting Liao </title> <meta name="author" content="Tingting Liao"> <meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. "> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/icon.png?cf7d278f0f40bdd17f7c63df46d33eb3"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://tingtingliao.github.io/blog/2019/Katyusha/"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?0afe9f0ae161375728f7bcc5eb5b4ab4"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Tingting</span> Liao </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Katyusha</h1> <p class="post-meta"> April 29, 2019 • Tintin </p> <p class="post-tags"> <a href="/blog/2019"> <i class="fa-solid fa-calendar fa-sm"></i> 2019 </a>   ·   <a href="/blog/tag/optimization"> <i class="fa-solid fa-hashtag fa-sm"></i> Optimization</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <script type="text/javascript" async="" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"> </script> <p><a href="http://jmlr.csail.mit.edu/papers/volume18/16-410/16-410.pdf" rel="external nofollow noopener" target="_blank">\(Katyusha\)</a>算是<a href="https://tintin.space/2019/04/25/Linear_Coupling/" rel="external nofollow noopener" target="_blank">\(Gradient-Mirror Linear Coupling\)</a>的扩展。Linear Coupling是\(GradientDescent\)和\(MirrorDescent\)的线性组合，达到了Nesterov加速的效果。但Linear Coupling将\(GD\)换成\(SGD\)的时候效果并不好，于是Zeyuan为\(SGD\)重新设计一个加速的方法，它依旧是以线性耦合的思想，并利用\(SVRG\)更好帮助其加速。</p> <h2 id="1-momentum">1. Momentum</h2> \[v_{k+1} = \gamma v_{k} + g_k\] \[x_{k+1} = x_k - v_{k+1}\] <p>其中\(\gamma\)为动量常数，\(g\)为步长，普通的momentum中\(g_k=\eta \triangledown f(x_k)\)计算当前梯度，Nesterov’s Momentum中\(g_k= \eta \triangledown f(x_k-\gamma v_{k})\)计算向前一步后的梯度，\(\eta\)为学习率。momentum和Nesterov’s Momentum本质上都是计算历史梯度的加权平均，下文将两者统称为momentum。</p> <table> <tbody> <tr> <td>\(v_0 = 0\)</td> <td>\(x_0\)</td> </tr> <tr> <td>\(v_1 = g_0\)</td> <td>\(x_1 = x_0 - g_0\)</td> </tr> <tr> <td>\(v_2 = \gamma g_0 + g_1\)</td> <td>\(x_2 = x_0 - (1+\gamma)g_0 - g_1\)</td> </tr> <tr> <td>\(v_3 = \gamma^2 g_0 + \gamma g_1 + g_2\)</td> <td>\(x_3 = x_0 - (1+\gamma+\gamma^2)g_0 - (1+\gamma)g_1 - g_2\)</td> </tr> <tr> <td>\(...\)</td> <td>\(...\)</td> </tr> <tr> <td>\(v_{k+1} = \sum_{i=0}^{k} \gamma^i g_{k-i}\)</td> <td>\(x_{k+1} = x_0 -\sum_{i=0}^{k} v_i\)</td> </tr> </tbody> </table> \[v_{k+1} = g_k + \gamma g_{k-1} + \gamma^2 g_{k-2} + ...+\gamma^k g_0\] <p>动量参数\(\gamma \in (0,1)\),当前更新的步长\(x_{k+1} = x_k-v_{k+1}\)为历史梯度序列的加权组合,且时间越近的权重越大越远权重越小。</p> \[x_{k+1} = x_0 - g_{k} -(1+\gamma)g_{k-1} -...- (1+\gamma+...+\gamma^k)g_0\] <p>而随着迭代次数的增加，\(x_{k+1}\)减去关于梯度\(g_0\)的权重在逐渐增加。</p> <h3 id="2-katyusha">2. Katyusha</h3> <p><img src="/img/Katyusha/Algorithm.png" alt=""></p> \[\begin{split} \quad x_{k+1}&amp; \leftarrow \tau_1 z_k+\tau_2 \tilde{x} + (1-\tau_1-\tau_2) y_k\\ \tilde{\triangledown}_{k+1} &amp; \leftarrow \triangledown f(\tilde{x})+\triangledown f_i(x_{k+1}) -\triangledown_i f(\tilde{x})\\ y_{k+1}&amp;\leftarrow x_{k+1} - \frac{1}{3L}\tilde{\triangledown}_{k+1} \\ z_{k+1}&amp;\leftarrow z_{k} - \alpha\tilde{\triangledown}_{k+1} \\ \end{split}\] <p>当\(\tau_1 = \tau_2=0\)时，算法就变成\(SVRG\).</p> <p>当\(\tau_2=0\),令\(\tau = \tau_1\)，即变成了Linear Coupling（LC）中两者线性组合的形式，不同的是\(LC\)中是\(GD\)与\(MD\)的组合，而这里是\(SGD\),估计梯度\(\tilde{\triangledown}_{k+1}\)利用SVRG计算。而\(LC\)实际上也是momentum加速算法的一种形式。</p> <h3 id="21-linear-coupling与momentum">2.1 Linear Coupling与Momentum</h3> \[\quad x_{k+1} \leftarrow \tau z_k+ (1-\tau) y_k\] <p>跟上面momentum类似,这里的\(g=\eta \tilde{\triangledown}_{k+1}\)是利用SVRG计算的,\(y_{k+1}\)是在\(x_{k+1}\)的基础上进行一步\(SGD\)，\(z_{k+1}\)是在\(z_{k}\)上进行一步\(MirrorDescent\).在Linear Coupling中说过\(\tau=\frac{1}{\alpha L+1}\)，那么\(\alpha = \frac{1}{\tau L} - \frac{1}{L}&lt;\frac{1}{\tau L}\)，在Katyusha中，为了计算简便取\(\alpha =\frac{1}{3\tau L}\).下面看它是如何进行动量计算的。</p> <p>初始值：\(y_0 = z_0=x_0\)</p> <table> <tbody> <tr> <td>\(x_1 = x_0\)</td> <td>\(y_1 = x_0-\frac{1}{3L}\tilde{\triangledown}_{1}\)</td> <td>\(z_1 = x_0 - \alpha \tilde{\triangledown}_{1}\)</td> </tr> <tr> <td>\(x_2 = x_0 - ( \frac{1-\tau}{3L}+\tau\alpha ) \tilde{\triangledown}_{1}\)</td> <td>\(y_2 = x_0 - \frac{1}{3L}\tilde{\triangledown}_{2} -( \frac{1-\tau}{3L} +\tau\alpha) \tilde{\triangledown}_{1}\)</td> <td>\(z_2 = x_0 - \alpha(\tilde{\triangledown}_{1} + \tilde{\triangledown}_{2})\)</td> </tr> </tbody> </table> <table> <tbody> <tr> <td>\(x_3 = x_0 - ((1-\tau)\frac{1}{3L} +\tau\alpha ) \tilde{\triangledown}_{2} - ((1-\tau)^2\frac{1}{3L} + (1-(1-\tau)^2)\alpha) \tilde{\triangledown}_{1}\)</td> </tr> </tbody> </table> \[\begin{split} x_{2} &amp;= x_{1}- ((1-\tau)\frac{1}{3L} +\tau\alpha ) \tilde{\triangledown}_{1} \\ x_{3} &amp;= x_{2}- ((1-\tau)\frac{1}{3L} +\tau\alpha ) \tilde{\triangledown}_{2} - (\frac{(1-\tau)^2-(1-\tau)}{3L} + ((1-\tau)-(1-\tau)^2)\alpha) \tilde{\triangledown}_{1} \end{split}\] <p>类似的，Linear Coupling每次移动的步长也是历史梯度的组合，随着迭代次数的增加，\(x_{k+1}\)关于\(\tilde{\triangledown}_{1}\)的权重也是逐渐增加的。</p> \[\begin{split} x_{k+1} &amp;= x_0-\sum_{i=1}^{k} ((1-\tau)^{k-i}\frac{1}{3L} +(1-(1-\tau)^{k-i})\alpha ) \tilde{\triangledown}_{i} 【LC】 \\ x_{k+1} &amp;= x_0 - \sum_{i=0}^{k} (\gamma^0+...+\gamma^{k-i})g_i 【Momentum】 \end{split}\] <p>两者在某种程度上可以说是等价的。其中\(\alpha =\frac{1}{3\tau L}\)，当我们令\(g_i = \frac{1}{3L} \tilde{\triangledown}_{i}\),那么求和括号内项： </p> \[(1-\tau)^{k-i} +(1-(1-\tau)^{k-i})\frac{1}{\tau} \in (1,\frac{1}{\tau}) \quad (1)\] \[\gamma^0+...+\gamma^{k-i} = \frac{1-\gamma^n}{1-\gamma}\propto \frac{1}{1-\gamma} \in (1,+\infty)\] <p>(1)是根据\(\lambda a+ (1-\lambda)b \in (a,b)\),而\(\frac{1}{\tau}\in (1,+\infty)\)。可以看到实际上Linear Coupling也是一种momentum加速算法的一种形式。而作者发现把\(LC\)中的\(GD\)直接换成\(SGD\)时效果并不好，就像直接将Nesterov’s momentum加在\(SGD\)上时一样加速效果并不好。这是因为\(SGD\)梯度含有一定的噪声，而momentum是会记住历史梯度，它会让\(SGD\)继续往错误的方向加速前进。因此Zeyuan为\(SGD\)重新设计一个加速算法\(Katyusha\).</p> <h3 id="22-katyusha-momentum">2.2 Katyusha Momentum</h3> <p>Katyusha momentum在上述2.1节momentum中添加了新的一项\(\tau_2\tilde{x}\).论文中作者取\(\tau_2=0.5\),</p> \[\quad x_{k+1} \leftarrow \tau z_k+0.5 \tilde{x} + (0.5-\tau)y_k\] \[x_{k+1} = x_0-\sum_{i=1}^{k} ((0.5-\tau)^{k-i}\frac{1}{3L} +(0.5-(0.5-\tau)^{k-i})\alpha ) \tilde{\triangledown}_{i}\] <p>\(\tau_2\tilde{x} = x_0\),它依旧是\(z_k\)与\(y_k\)两者的线性耦合，只不过步长变成了原来的一半,\(\because \lambda_1+\lambda_1=k\),\(\lambda_1 a+\lambda_2 b \in (ka,kb)\),所以\(步长\in (\frac{1}{3L}\tilde{\triangledown}_{i} ,\alpha \tilde{\triangledown}_{i} )\Rightarrow (\frac{0.5}{3L}\tilde{\triangledown}_{i} ,0.5\alpha \tilde{\triangledown}_{i} )\)。即每执行一步momentum都往后向\(x_0\)的方向退一步，因此该步骤也叫做负动量Negative momentum.</p> <p><img src="/img/PrimalDual/Katyusha.jpg" alt=""></p> <p>如图，黑线（\(SGD\)）为在\(x_{k}\)点走了一步负梯度方向得到\(y_k\)，绿色线（momentum）为\(y_k\)与\(z_k\)组合后的\(x_2'\)即\(\tau_2=0\)的momentum加速，橙色线（Katyusha Momentum）为\(x_2'\)与起点\(x_0\)连线中点。</p> \[\begin{split} 黑SGD：&amp;y_1 \leftarrow x_1 - \frac{1}{3L} \tilde{\triangledown}_{1} \\ 绿Momentum：&amp;x_2' \leftarrow \tau y_1 + (1-\tau)z_1 = x_0-((1-\tau)\frac{1}{3L} +\tau\alpha ) \tilde{\triangledown}_{1} \\ 橙Katyusha Momentum：&amp;x_2 \leftarrow x_0-\frac{1}{2}((1-\tau)\frac{1}{3L} +\tau\alpha ) \tilde{\triangledown}_{1} \end{split}\] <p>在执行完\(m\)次内循环后，起始点\(\tilde{x}\)(磁铁)从该循环的终点开始继续下一轮的momentum更新。</p> <h3 id="23-收敛速率">2.3 收敛速率</h3> <p>\(SGD\)的发展主要分为三个阶段：传统\(SGD\)、方差缩减方法以及加速\(SGD\)。</p> <p>\(SGD\)只需要计算单个样本比\(GD\)计算量小\(n\)倍，但其收敛速率仅为\(\frac{1}{\epsilon}\)尽管目标函数是强凸的。因此第二个阶段中以\(SVRG\)为代表的方差缩减方法将\(SGD\)的收敛速度提升到了\(O((n+\frac{L}{\sigma})\log\frac{1}{\epsilon})\),而它依赖于\(\kappa=\frac{L}{\sigma}\)我们称为“条件数量”，那么是否可以设计一个更快的算法达到\(\sqrt\kappa\)的依赖速度？\(APPA\)和\(Catalyst\)做到了也迎来了\(SGD\)的加速阶段，收敛速度提升到了\(O((n+\sqrt{n\kappa })\log\kappa \log\frac{1}{\epsilon})\)，但是\(Catalyst\)依旧不够完美，\(Katyusha\)消去了\(\log\kappa\)达到了最优收敛速率\(O((n+\sqrt{n\kappa }) \log\frac{1}{\epsilon})\)。</p> <table> <thead> <tr> <th style="text-align: center"> </th> <th style="text-align: center">Variance Reduction</th> <th style="text-align: center">Acceleration(momentum)</th> </tr> </thead> <tbody> <tr> <td style="text-align: center"> <br>\(SGD\)</td> <td style="text-align: center">\(SAG\) <br>\(SVRG\)<br>\(SAGA\)</td> <td style="text-align: center">\(APPA\)<br>\(Catalyst\)<br>\(Katyusha\)</td> </tr> </tbody> </table> <table> <thead> <tr> <th style="text-align: center"> </th> <th style="text-align: center">强凸光滑</th> <th style="text-align: center">强凸不光滑</th> <th style="text-align: center">非强凸光滑</th> <th style="text-align: center">非强凸不光滑</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">\(SGD\)</td> <td style="text-align: center">\(O(\frac{L^2}{\sigma \epsilon})\)</td> <td style="text-align: center">\(O(\frac{G}{\sigma \epsilon})\)</td> <td style="text-align: center">\(O(\frac{L^2}{\epsilon^2})\)</td> <td style="text-align: center">\(O(\frac{G}{ \epsilon^2})\)</td> </tr> <tr> <td style="text-align: center">\(SVRG\)</td> <td style="text-align: center">\(O((n+\kappa )\log\frac{1}{\epsilon})\)</td> <td style="text-align: center">\(O(n\log\frac{1}{\epsilon}+\frac{G}{\sigma\epsilon})\)</td> <td style="text-align: center">\(O(n\log\frac{1}{\epsilon}+\frac{L}{\epsilon})\)</td> <td style="text-align: center"> </td> </tr> <tr> <td style="text-align: center">\(Katyusha\)</td> <td style="text-align: center">\(O((n+\sqrt{n\kappa })\log\frac{1}{\epsilon})\)</td> <td style="text-align: center"> </td> <td style="text-align: center">\(O(n\log\frac{1}{\epsilon}+ \sqrt{n\frac{L}{\epsilon})}\)</td> <td style="text-align: center"> </td> </tr> </tbody> </table> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2019/Primal/">Primal Dual Problem</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2019/Linear_Coupling/">梯度下降与镜像下降线性耦合</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2019/VarienceReduction/">Variance Reduction</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2019/Proximal-Descent/">近端梯度下降</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2020/MeanFieldTheory/">Mean Field Theory Solution of the Ising Model</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Tingting Liao. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2930004b8d7fcd0a8e00fdcfc8fc9f24"></script> <script defer src="/assets/js/common.js?da39b660470d1ba6e6b8bf5f37070b6e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>